function traverse(e,t){e.find("li").each(function(n,r){var i=$(r).parents();i=i[1],i==e[0]&&t.push(r)})}var newNodeType="primary-categ",selectedCategNode;$(function(){var e=$.tree_create();e.init("#categ-wrapper",{ui:{theme_name:"apple"},rules:{draggable:"all",dragrules:["secondary-categ inside root","secondary-categ inside primary-categ","primary-categ after primary-categ","primary-categ before primary-categ","primary-categ inside primary-categ"],drag_copy:"ctrl",renameable:["primary-categ","secondary-categ"]},callback:{onselect:function(e,t){$(e).attr("rel")=="root"?newNodeType="primary-categ":newNodeType="secondary-categ",selectedCategNode=$(e).attr("rel")},beforecreate:function(e,t){var n=$(e).attr("rel");return n=="primary-categ"||n=="root"?!0:(alert(translate("You can not create more than level 2 categories.")),!1)},oncreate:function(e,t,n,r){return $(e).attr("rel",newNodeType),!0},beforemove:function(e,t){var n=$(e).parents("li").get(0);n=$(n).attr("rel");if(n=="primary-categ"||n=="root"){if($(e).find("ul").length)return!1}else if(n=="secondary-categ")return!1;return!0},onmove:function(e,t,n){var r=$(e).parents("li").get(0);r=$(r).attr("rel");if(r=="root")$(e).attr("rel","primary-categ");else{if(r!="primary-categ")return!1;if($(e).find("ul").length)return!1;$(e).attr("rel","secondary-categ")}return!0}},selected:"node_root"}),$("#createNewNode").click(function(){e.create()}),$("#renameNode").click(function(){e.rename()}),$("#deleteNode").click(function(){selectedCategNode=="root"?alert(translate("You surely don't want to delete the root node, do you?")):confirm(translate("Are you sure you want to delete this category and all its subcategories?"))&&e.remove()}),$("#saveConfiguration").click(function(){var e={categories:[]},t=[];traverse($("#node_root"),t),$(t).each(function(e,n){traverse($(n),t)}),$(t).each(function(t,n){var r={};r.name=$.trim($(n).children(":first").text()),r.id=$(n).attr("id");if($(n).attr("rel")=="primary-categ")r.parentId=0;else{var i=$(n).parents("li[rel='primary-categ']").get(0);r.parentId=$(i).attr("id"),r.parentName=$.trim($(i).children(":first").text())}e.categories.push(r)}),$("#saveDialog").dialog({bgiframe:!0,modal:!0,hide:"highlight",autoOpen:!1,buttons:{Ok:function(){$(this).dialog("option","mustReload")&&window.location.reload(),$(this).dialog("close")}}}),$.post("/admin/categories",{data:$.toJSON(e)},function(e){$("#saveDialog").dialog("option","mustReload",e.mustReload).dialog("open")},"json")})});